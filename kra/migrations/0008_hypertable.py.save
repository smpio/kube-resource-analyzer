# Generated by Django 3.2.2 on 2021-05-18 15:46
# ERROR:  cannot create a unique index without the column "measured_at" (used in partitioning)
# Need to drop ID primary key first

from django.db import migrations


def create_hypertable(apps, schema_editor):
    model = apps.get_model('kra', 'ResourceUsage')
    table = model._meta.db_table
    column = model._meta.get_field('measured_at').column
    schema_editor.execute(f"SELECT create_hypertable('{table}', '{column}', migrate_data => true)")


class Migration(migrations.Migration):

    dependencies = [
        ('kra', '0007_add_time_indexes'),
    ]

    operations = [
        migrations.RunPython(create_hypertable),
    ]
